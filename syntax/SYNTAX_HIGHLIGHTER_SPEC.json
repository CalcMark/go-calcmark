{
  "$comment": "IMPORTANT: This file is a first-class deliverable that MUST stay synchronized with the Go implementation. It is validated by tests in lexer/syntax_spec_test.go on every test run. This file can be served via HTTP endpoint (/syntax) or bundled in TypeScript clients for syntax highlighting.",
  "breakingChanges": {
    "v1.0.0": [
      {
        "after": "my_budget = 1000",
        "before": "my budget = 1000",
        "change": "Spaces no longer allowed in identifiers",
        "migration": "Replace spaces in identifier names with underscores",
        "rationale": "Required to support multi-token function names like 'average of' and 'square root of'"
      }
    ]
  },
  "classification": {
    "contextAware": {
      "description": "Classification depends on execution context",
      "notes": "A line like 'unknown_var' is markdown if the variable is undefined, but a calculation if it's defined in the context"
    },
    "description": "How lines are classified",
    "lineTypes": {
      "blank": {
        "description": "Empty lines or whitespace-only",
        "pattern": "^\\s*$"
      },
      "calculation": {
        "criteria": [
          "Literal values (number, currency, boolean)",
          "Variable assignments (x = 5)",
          "Arithmetic expressions (3 + 5)",
          "Comparison expressions (x \u003e 5)",
          "Logical expressions (x \u003e 5 and y \u003c 10)",
          "Function calls (avg(1, 2, 3) or average of 1, 2, 3)",
          "Variable references (if variable is defined in context)"
        ],
        "description": "Lines containing CalcMark calculations"
      },
      "markdown": {
        "criteria": [
          "Starts with markdown prefix (# \u003e - * digit.)",
          "Contains trailing text after calculation",
          "Contains unknown variables (context-aware)",
          "Contains malformed expressions",
          "Contains URLs or natural language"
        ],
        "description": "Lines that are pure markdown"
      }
    }
  },
  "description": "CalcMark Language Syntax Specification for Syntax Highlighters",
  "examples": {
    "functions": [
      "avg(1, 2, 3, 4, 5)",
      "average of 10, 20, 30",
      "sqrt(16)",
      "square root of 25"
    ],
    "logical": [
      "x \u003e 5 and y \u003c 10",
      "salary \u003e $50000 or bonus \u003e $10000",
      "not (x == 0)"
    ],
    "mixed": [
      "# Budget Calculator",
      "",
      "monthly_income = $5000",
      "monthly_expenses = $3500",
      "",
      "Has surplus:",
      "surplus = monthly_income \u003e monthly_expenses"
    ],
    "simple": [
      "salary = $50000",
      "bonus = $5000",
      "total = salary + bonus"
    ]
  },
  "fileExtensions": [
    ".cm",
    ".calcmark"
  ],
  "futureFeatures": {
    "description": "Reserved but not yet implemented",
    "features": [
      {
        "example": "if sales \u003e $100000 then tax = 20% else tax = 15% end",
        "keywords": [
          "if",
          "then",
          "else",
          "elif",
          "end"
        ],
        "name": "Conditionals"
      },
      {
        "example": "for month in months do total = total + month end",
        "keywords": [
          "for",
          "in",
          "while"
        ],
        "name": "Loops"
      },
      {
        "examples": [
          "min()",
          "max()",
          "sum()",
          "round()"
        ],
        "name": "Additional functions"
      }
    ]
  },
  "implementationNotes": {
    "tokenization": {
      "multiTokenCombining": "After initial tokenization, sequences like 'IDENTIFIER(average) + IDENTIFIER(of)' are post-processed and combined into FUNC_AVERAGE_OF",
      "multiplyAliases": "The letter 'x' or 'X' is treated as multiply operator when preceded by a number and followed by whitespace or digit",
      "thousandSeparators": "Commas and underscores within numbers are only consumed if followed by a digit, otherwise they become separate tokens"
    },
    "validation": {
      "diagnosticCodes": true,
      "notes": "Validator runs in parallel with evaluator and provides detailed diagnostic codes",
      "severityLevels": [
        "error",
        "warning",
        "info",
        "hint"
      ]
    }
  },
  "language": "calcmark",
  "syntaxRules": {
    "caseInsensitivity": {
      "booleans": true,
      "functions": true,
      "identifiers": false,
      "keywords": true,
      "notes": "Identifiers are case-sensitive, but keywords and functions are not"
    },
    "precedence": {
      "description": "Operator precedence (not yet fully implemented in parser)",
      "notes": "Precedence follows Go language specification for logical operators",
      "order": [
        {
          "description": "Exponentiation (highest)",
          "level": 1,
          "operators": [
            "^",
            "**"
          ]
        },
        {
          "description": "Multiplication, division, modulus",
          "level": 2,
          "operators": [
            "*",
            "Ã—",
            "x",
            "X",
            "/",
            "%"
          ]
        },
        {
          "description": "Addition, subtraction",
          "level": 3,
          "operators": [
            "+",
            "-"
          ]
        },
        {
          "description": "Comparison",
          "level": 4,
          "operators": [
            "\u003e",
            "\u003c",
            "\u003e=",
            "\u003c=",
            "==",
            "!="
          ]
        },
        {
          "description": "Logical NOT",
          "level": 5,
          "operators": [
            "not"
          ]
        },
        {
          "description": "Logical AND",
          "level": 6,
          "operators": [
            "and"
          ]
        },
        {
          "description": "Logical OR (lowest)",
          "level": 7,
          "operators": [
            "or"
          ]
        }
      ]
    },
    "whitespace": {
      "notes": [
        "Spaces around operators are optional (3+5 or 3 + 5)",
        "Spaces separate tokens in multi-token functions (average of)",
        "Tabs and spaces are equivalent",
        "Newlines separate statements"
      ],
      "significance": "mostly insignificant"
    }
  },
  "tokens": {
    "identifiers": {
      "allowedCharacters": "Any Unicode character except whitespace and reserved operators",
      "description": "Variable names",
      "examples": [
        "salary",
        "my_budget",
        "weeks_in_year",
        "çµ¦æ–™",
        "ðŸ’°",
        "rÃ©sumÃ©"
      ],
      "notAllowed": [
        "Spaces",
        "Reserved keywords",
        "Reserved operators"
      ],
      "notes": "BREAKING CHANGE: Spaces are NOT allowed in identifiers (use underscores instead). Unicode and emoji fully supported.",
      "pattern": "[^\\s\\d\\+\\-\\*Ã—\\/=$\u003e\u003c! %^(),][^\\s\\+\\-\\*Ã—\\/=$\u003e\u003c! %^(),]*",
      "unicodeSupport": true
    },
    "keywords": {
      "controlFlow": {
        "caseInsensitive": true,
        "description": "Reserved for future control flow (not yet implemented)",
        "tokens": [
          "if",
          "then",
          "else",
          "elif",
          "end",
          "for",
          "in",
          "while",
          "return",
          "break",
          "continue",
          "let",
          "const"
        ]
      },
      "description": "Reserved keywords that cannot be used as identifiers",
      "functions": {
        "canonical": {
          "avg": {
            "aliases": [
              "average of"
            ],
            "description": "Calculate average of numbers",
            "syntax": [
              "avg(x, y, ...)",
              "average of x, y, ..."
            ]
          },
          "sqrt": {
            "aliases": [
              "square root of"
            ],
            "description": "Calculate square root",
            "syntax": [
              "sqrt(x)",
              "square root of x"
            ]
          }
        },
        "caseInsensitive": true,
        "description": "Built-in function names (canonical forms)"
      },
      "logicalOperators": {
        "caseInsensitive": true,
        "description": "Logical operators (Go spec compliant)",
        "tokens": [
          "and",
          "or",
          "not"
        ]
      },
      "multiTokenFunctions": {
        "description": "Multi-word function names that are combined during tokenization",
        "tokens": [
          {
            "canonical": "avg",
            "caseInsensitive": true,
            "pattern": "average of",
            "requiresWhitespace": true
          },
          {
            "canonical": "sqrt",
            "caseInsensitive": true,
            "pattern": "square root of",
            "requiresWhitespace": true
          }
        ]
      }
    },
    "literals": {
      "boolean": {
        "caseInsensitive": true,
        "description": "Boolean literals",
        "examples": [
          "true",
          "false",
          "yes",
          "no",
          "t",
          "f",
          "y",
          "n"
        ],
        "falseValues": [
          "false",
          "no",
          "f",
          "n"
        ],
        "notes": "Boolean keywords are normalized to lowercase 'true' or 'false' during tokenization",
        "trueValues": [
          "true",
          "yes",
          "t",
          "y"
        ]
      },
      "currency": {
        "description": "Currency literals",
        "examples": [
          "$100",
          "$1,000.50",
          "$1_000"
        ],
        "notes": "Currently only $ symbol supported, commas/underscores allowed",
        "pattern": "\\$\\d+(\\.\\d+)?",
        "thousandsSeparators": [
          ",",
          "_"
        ]
      },
      "number": {
        "description": "Numeric literals",
        "examples": [
          "42",
          "3.14",
          "1,000",
          "1_000_000"
        ],
        "notes": "Commas and underscores are allowed as thousand separators and are stripped during tokenization",
        "pattern": "\\d+(\\.\\d+)?",
        "thousandsSeparators": [
          ",",
          "_"
        ]
      }
    },
    "markdown": {
      "description": "Markdown elements that CalcMark preserves",
      "notes": "Lines starting with markdown prefixes are classified as markdown, not calculations",
      "prefixes": [
        {
          "description": "Headers (#, ##, ###, etc.)",
          "pattern": "^#+\\s"
        },
        {
          "description": "Blockquotes",
          "pattern": "^\u003e\\s"
        },
        {
          "description": "Unordered lists",
          "pattern": "^[-*]\\s"
        },
        {
          "description": "Ordered lists",
          "pattern": "^\\d+\\.\\s"
        }
      ]
    },
    "operators": {
      "arithmetic": {
        "description": "Arithmetic operators",
        "tokens": [
          {
            "description": "Addition",
            "name": "plus",
            "symbol": "+"
          },
          {
            "description": "Subtraction or unary negation",
            "name": "minus",
            "symbol": "-"
          },
          {
            "aliases": [
              "Ã—",
              "x",
              "X"
            ],
            "description": "Multiplication",
            "name": "multiply",
            "symbol": "*"
          },
          {
            "description": "Division",
            "name": "divide",
            "symbol": "/"
          },
          {
            "description": "Modulus/remainder",
            "name": "modulus",
            "symbol": "%"
          },
          {
            "aliases": [
              "**"
            ],
            "description": "Exponentiation",
            "name": "exponent",
            "symbol": "^"
          }
        ]
      },
      "assignment": {
        "description": "Assignment operator",
        "tokens": [
          {
            "description": "Variable assignment",
            "name": "assign",
            "symbol": "="
          }
        ]
      },
      "comparison": {
        "description": "Comparison operators",
        "tokens": [
          {
            "description": "Greater than",
            "name": "greater_than",
            "symbol": "\u003e"
          },
          {
            "description": "Less than",
            "name": "less_than",
            "symbol": "\u003c"
          },
          {
            "description": "Greater than or equal",
            "name": "greater_equal",
            "symbol": "\u003e="
          },
          {
            "description": "Less than or equal",
            "name": "less_equal",
            "symbol": "\u003c="
          },
          {
            "description": "Equal",
            "name": "equal",
            "symbol": "=="
          },
          {
            "description": "Not equal",
            "name": "not_equal",
            "symbol": "!="
          }
        ]
      }
    },
    "punctuation": {
      "description": "Punctuation and delimiters",
      "tokens": [
        {
          "description": "Left parenthesis",
          "name": "lparen",
          "symbol": "("
        },
        {
          "description": "Right parenthesis",
          "name": "rparen",
          "symbol": ")"
        },
        {
          "description": "Comma (function argument separator)",
          "name": "comma",
          "symbol": ","
        }
      ]
    }
  },
  "version": "0.1.1"
}